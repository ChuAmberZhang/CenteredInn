var hotelControllers=angular.module("hotelControllers",["firebase"]),config={apiKey:"<FirebaseAPIKEY>",authDomain:"centeredinn.firebaseapp.com",databaseURL:"https://centeredinn.firebaseio.com",storageBucket:"centeredinn.appspot.com",messagingSenderId:"530961530635"};firebase.initializeApp(config),hotelControllers.controller("SettingsController",["$scope","$window","$location","$firebaseAuth","CommonData",function($scope,$window,$location,$firebaseAuth,CommonData){$scope.loggedIn=!1,$scope.isLogin=!0,$scope.failed=!1,$scope.switchMessage="New user? Sign up here!",$scope.buttonLabel="Login",$scope.search={city:"",start:"",end:""},$scope.login={email:"",pwd:""},$scope.signup={name:"",email:"",pwd:""},$scope.fail={message:""},$scope.openAccountinSettings=function(){console.log("account"),$scope.loggedIn&&$location.path("/account")},$scope["switch"]=function(e){$scope.isLogin?($scope.switchMessage="Already a user? Login here!",$scope.buttonLabel="Sign Up"):($scope.switchMessage="New user? Sign up here!",$scope.buttonLabel="Login"),$scope.isLogin=!$scope.isLogin},$scope.login=function(e){if($scope.authObj=$firebaseAuth(),$scope.isLogin){var email=$scope.login.email,password=$scope.login.pwd;$scope.authObj.$signInWithEmailAndPassword(email,password).then(function(firebaseUser){console.log("Signed in as:",firebaseUser.uid),$scope.loggedIn=!0,CommonData.setUID(firebaseUser.uid)})["catch"](function(error){console.error("Authentication failed:",error),$scope.failed=!0,$scope.fail.message=error.message})}else{var username=$scope.signup.name,email=$scope.signup.email,password=$scope.signup.pwd;$scope.authObj.$createUserWithEmailAndPassword(email,password).then(function(firebaseUser){console.log("User "+firebaseUser.uid+" "+username+" created successfully!"),$scope.loggedIn=!0,CommonData.setUID(firebaseUser.uid)})["catch"](function(error){console.error("Error: ",error),$scope.failed=!0,$scope.fail.message=error.message})}},$scope.searchSpots=function(e){var city=$scope.search.city;CommonData.setCity(city),CommonData.setStartDate($scope.search.start),CommonData.setEndDate($scope.search.end),$location.path("/main")}}]),hotelControllers.controller("MainController",["$scope","Amadeus","$window","CommonData",function($scope,Amadeus,$window,CommonData){function refresh(hotelIcon){if(1==hotelIcon)for(var i=0;i<$scope.hotels.length;i++)console.log($scope.hotels[i].details),addMarker($scope.hotels[i].details,hotelIcon);else{deleteMarkers();for(var i=0;i<$scope.spots.length;i++)console.log($scope.spots[i]),addMarker($scope.spots[i],hotelIcon)}console.log($scope.markers.length),showMarkers();for(var bounds=new google.maps.LatLngBounds,i=0;i<$scope.markers.length;i++)bounds.extend($scope.markers[i].getPosition());map.fitBounds(bounds)}function addMarker(spot,hotelIcon){var iconLink;iconLink=hotelIcon?"../media/hotel.png":"../media/spot.png",console.log("add");var marker=new google.maps.Marker({position:{lat:spot.location.latitude,lng:spot.location.longitude},map:$window.map,icon:iconLink});jQuery(document).ready(function($){hotelIcon?(console.log(spot.property_name),marker.addListener("mouseover",function($event){var imglink="../media/hotelAlt.png";void 0!=spot.image&&(imglink="spot.image[0]");var str="<div style='padding:10px;'><h6>"+spot.property_name+"</h6><img class='col-sm-6' src = '"+imglink+"' style='width:80px;height:auto;margin-bottom: 20px'></div>";infowindow.setContent(str),infowindow.open($window.map,marker);var list_item=document.getElementById("geo"+spot.property_name);$(list_item).css("background-color","#a8c6e4")})):(marker.addListener("mouseover",function($event){var imglink="../media/hotelAlt.png";void 0!=spot.main_image&&(imglink=spot.main_image);var str="<div style='padding:10px;'><h6>"+spot.title+"</h6><img class='col-sm-6' src='"+spot.main_image+"' alt='../media/sceneAlt.png' style='width:80px;height:auto;margin-bottom: 20px'></div>";infowindow.setContent(str),infowindow.open($window.map,marker);var list_item=document.getElementById("geo"+spot.geoname_id);$(list_item).css("background-color","#a8c6e4")}),marker.addListener("mouseout",function($event){infowindow.close();var list_item=document.getElementById("geo"+spot.geoname_id);$(list_item).css("background-color","white")}))}),$scope.markers.push(marker),setMapOnAll($window.map),console.log($scope.markers.length)}function setMapOnAll(map){for(var i=0;i<$scope.markers.length;i++)$scope.markers[i].setMap(map)}function clearMarkers(){setMapOnAll(null)}function showMarkers(){setMapOnAll(map)}function deleteMarkers(){clearMarkers(),$scope.markers.length=0}$scope.markers=[],$scope.currCity,$window.map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.1147412,lng:-88.3471495},zoom:8}),$scope.spots,$scope.hotels;var infowindow=new google.maps.InfoWindow({content:null,disableAutoPan:!0}),cityParam=CommonData.getCity();$scope.openAccountinMain=function(){console.log("account"),0!=CommonData.getUID().length?$location.path("/account"):$location.path("/#")},0!=cityParam.length&&(console.log(cityParam),Amadeus.getSpotsAPI(cityParam).success(function(data){$scope.spots=data.points_of_interest,$scope.currCity=data.current_city,$window.map=new google.maps.Map(document.getElementById("map"),{center:{lat:$scope.currCity.location.latitude,lng:$scope.currCity.location.longitude},zoom:12}),refresh(!1)}).error(function(data){$scope.spots=data.message})),$("#accountLink").on("click",function(e){$(location).attr("href","/#/account")}),$scope.expand=function(){},window.onload=function(){$(".accordion").foundation()},$scope.searchHotels=function(e){console.log("entered search hotels"),$scope.checkedArray=[],angular.forEach($scope.spots,function(spot){spot.selected&&$scope.checkedArray.push(spot)}),console.log($scope.checkedArray);var hotelDict={};console.log("Before calling hotels");for(var it=0;it<$scope.checkedArray.length;it++){var checked=$scope.checkedArray[it];if("location"in checked){var startDate=CommonData.getStartDate(),endDate=CommonData.getEndDate();Amadeus.getHotelsAPI(checked.location.latitude,checked.location.longitude,startDate,endDate).success(function(data){for(var hotels=data.results,i=0;i<hotels.length;i++){var code=hotels[i].property_code;code in hotelDict?hotelDict[code].count=hotelDict[code].count+1:hotelDict[code]={count:1,details:hotels[i]}}if(it==$scope.checkedArray.length){var items=[];for(var h in hotelDict)items.push([h,hotelDict[h]]);items.sort(function(first,second){return second[1].count-first[1].count}),$scope.hotels=items.map(function(element){return element[1]}),console.log($scope.hotels)}refresh(!0)}).error(function(data){console.log(data.message)})}}}}]),hotelControllers.controller("AccountController",["$scope","$window","$location","$firebaseArray","CommonData",function($scope,$window,$location,$firebaseArray,CommonData){console.log("in account controller"),console.log(CommonData.getUID()),0==CommonData.getUID().length?$location.path("/#"):console.log("yeah")}]);